<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>온라인 체스</title>
<style>
body { font-family: Arial; text-align:center; }
button,input { padding:6px; font-size:14px; }
.status { margin:10px; font-weight:bold; }

.board-wrapper {
  display:inline-grid;
  grid-template-columns: 30px auto;
  grid-template-rows: auto 30px;
}
.ranks {
  display:grid;
  grid-template-rows:repeat(8,60px);
  align-items:center;
  font-weight:bold;
}
.files {
  grid-column:2;
  display:grid;
  grid-template-columns:repeat(8,60px);
  font-weight:bold;
}
.board {
  display:grid;
  grid-template-columns:repeat(8,60px);
  grid-template-rows:repeat(8,60px);
  border:4px solid #333;
}
.square {
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:38px;
  cursor:pointer;
}
.white{background:#f0d9b5;}
.black{background:#b58863;}
.selected{outline:3px solid red;}
</style>
</head>

<body>

<h1>온라인 체스</h1>

<div>
  <button onclick="createRoom()">방 만들기</button>
  <input id="roomInput" placeholder="방 코드 입력">
  <button onclick="joinRoom()">입장</button>
</div>

<div id="status" class="status">대기 중</div>

<div class="board-wrapper">
  <div class="ranks">8 7 6 5 4 3 2 1</div>
  <div id="board" class="board"></div>
  <div class="files">A B C D E F G H</div>
</div>

<script>
const boardEl = document.getElementById("board");
const statusEl = document.getElementById("status");

let room = null;
let playerColor = null;
let selected = null;

const initialBoard = [
 "♜","♞","♝","♛","♚","♝","♞","♜",
 "♟","♟","♟","♟","♟","♟","♟","♟",
 "","","","","","","","",
 "","","","","","","","",
 "","","","","","","","",
 "","","","","","","","",
 "♙","♙","♙","♙","♙","♙","♙","♙",
 "♖","♘","♗","♕","♔","♗","♘","♖"
];

function draw() {
  boardEl.innerHTML="";
  const game = JSON.parse(localStorage.getItem(room));
  game.board.forEach((p,i)=>{
    const d=document.createElement("div");
    d.className="square "+((Math.floor(i/8)+i)%2?"black":"white");
    d.textContent=p;
    d.onclick=()=>click(i);
    boardEl.appendChild(d);
  });
}

function click(i){
  const game = JSON.parse(localStorage.getItem(room));
  if(game.turn !== playerColor) return;

  const p = game.board[i];
  const isWhite = p && p==="♙♖♘♗♕♔".includes(p);

  if(selected===null){
    if(!p) return;
    if((playerColor==="백" && !isWhite) || (playerColor==="흑" && isWhite)) return;
    selected=i;
  } else {
    game.board[i]=game.board[selected];
    game.board[selected]="";
    selected=null;
    game.turn = game.turn==="백"?"흑":"백";
    localStorage.setItem(room,JSON.stringify(game));
    updateStatus();
    draw();
  }
}

function updateStatus(){
  const game=JSON.parse(localStorage.getItem(room));
  statusEl.textContent = `게임 시작 - ${game.turn} 차례 (${playerColor})`;
}

function createRoom(){
  room = "chess_"+Math.random().toString(36).substr(2,5);
  playerColor="백";
  localStorage.setItem(room, JSON.stringify({
    board:[...initialBoard],
    turn: Math.random()<0.5?"백":"흑",
    players:1
  }));
  statusEl.textContent="방 생성됨 - 상대 대기 중 (백)";
  draw();
}

function joinRoom(){
  room = document.getElementById("roomInput").value;
  const game = JSON.parse(localStorage.getItem(room));
  if(!game) return alert("방 없음");
  playerColor="흑";
  game.players=2;
  localStorage.setItem(room,JSON.stringify(game));
  updateStatus();
  draw();
}

</script>
</body>
</html>
